<!-- <link rel="import" href="../iron-collapse/iron-collapse.html"> -->
<!-- <link rel="import" href="../paper-styles/default-theme.html"> -->
<link rel="import" href="../polymer/polymer.html">

<!--
Missing Doc
@element paper-step
@demo demo/index.html
@hero hero.svg
-->
<dom-module id="paper-step">
  <template>
    <style>
      :host {
        display: block;
        box-sizing: border-box;
        /*outline: 0;*/
      }

      /*:host([vertical]) {
        @apply(--layout-vertical);
      }*/
      /*#collapse {
        --iron-collapse-transition-duration: var(--paper-vertical-step-transition-duration, 500ms);
        @apply(--layout-horizontal);
      }
      #stepWrapper {
        @apply(--layout-flex);*/
        /*should be 48px on large screen?*/
        /*padding-right: 24px;
      }
      #paperStepWrapper {
        max-height: calc(var(--paper-vertical-step-max-height, 400px) - 92px);
        @apply(--layout-scroll);
      }
      #contentConnectorLine {
        width: 1px;
        background: var(--divider-color, --paper-grey-300);
        margin-left: 36px;
        margin-right: 24px;
      }*/
      /**
       * Vertical Buttons
       */
      /*.iron-collapse-closed {
        display: none !important;
      }*/
    </style>

    <div id="contentContainer">
      <slot></slot>
    </div>


    <!-- vertical step layout -->

    <!-- <template>
      <step-vertical-label
        id="verticalStepLabel"
        editable="[[editable]]"
        label="[[label]]"
        optional="[[optional]]"
        opened="[[opened]]"
        selectable="[[selectable]]"
        stepper-data="[[_stepperData]]"
        index="[[index]]"
        saved="[[saved]]">
      </step-vertical-label>
    </template> -->

    <!-- <iron-collapse id="collapse" opened="[[opened]]">
    <div id="contentConnectorLine"></div>
    <div id="stepWrapper">
    <div id="paperStepWrapper">
  </div>
</div>
</iron-collapse> -->
  </template>

  <script>
    Polymer({

      is: 'paper-step',

      /**
       * Fired when the step has been saved.
       *
       * @event paper-step-saved
       */
      /**
       * Fired when the step has been updated
       *
       * @event paper-step-updated
       */
      properties: {

        /**
         * MISSING Doc
         */
        saved: {
          type: Boolean,
          value: false,
          notify: true,
          observer: '_savedChanged'
        },
        /**
         * Missing Doc
         */
        editable: {
          type: Boolean,
          value: false
        },
        /**
         * Missing Doc
         */
        index: {
          type: Number,
          notify: true,
          readOnly: true
        },
        /**
         * Missing Doc
         */
        optional: {
          type: Boolean,
          value: false
        },
        /**
         * Missing Doc
         */
        selectable: {
          type: Boolean,
          computed: '_computeSelectable(disabled, saved, editable)',
          reflectToAttribute: true,
          notify: true
        },
        /**
         * Missing Doc
         */
        disabled: {
          type: Boolean,
          value: false
        },
        /**
         * Missing Doc
         */
        label: {
          type: String,
          value: ''
        },
        /**
         * Missing Doc
         */
        opened: {
          type: Boolean,
          value: false,
          notify: true
        },
        /**
         * Missing Doc
         */
        vertical: {
          type: Boolean,
          readOnly: true,
          reflectToAttribute: true
        },
        _canSkip: {
          type: Boolean,
          readOnly: true
        },
        _hasBackStep: {
          type: Boolean,
          readOnly: true
        },
      },

      _instanceProps: {
        label: true,
        opened: true
      },

      observers: [
        '_forwardLabelElementProp("label", label, labelElement)',
        '_forwardLabelElementProp("editable", editable, labelElement)',
        '_forwardLabelElementProp("optional", optional, labelElement)',
        '_forwardLabelElementProp("opened", opened, labelElement)',
        '_forwardLabelElementProp("selectable", selectable, labelElement)',
        '_forwardLabelElementProp("index", index, labelElement)',
        '_forwardLabelElementProp("saved", saved, labelElement)',
        '_forwardLabelElementProp("disabled", disabled, labelElement)',
      ],

      _forwardLabelElementProp(prop, value, labelElement) {
        labelElement[prop] = value;
      },

      _savedChanged: function(newValue, oldValue) {
        if (newValue && oldValue != undefined && !oldValue) {
          this.fire('paper-step-saved');
        } else if (!newValue && oldValue) {
          this.fire('paper-step-unsaved');
        }
      },

      select: function() {
        this.fire('paper-step-select');
      },

      /**
       * Missing Doc
       */
      skip: function() {
        // would it be better to send an event?
        this.fire('paper-stepper-forward');
      },

      /**
       * Missing Doc
       */
      back: function() {
        // would it be better to send an event?
        this.fire('paper-stepper-back');
      },

      /**
       * Mark the step as saved and fire `paper-step-saved` if it is valid.
       * @return {Boolean} True if the step has been saved.
       */
      save: function() {
        if ((!this.saved || this.editable) && this.validate()) {
          this.saved = true;
          if (this.saved) {
            this.fire('paper-step-updated');
          } else {
            this.saved = true;
          }
          return true;
        }
        return false;
      },

      /**
       * Atempte to save the step and select and to progress into the stepper.
       * @return {Boolean} True if the step is valid for saving.
       */
      continue: function() {
        if (this.save()) {
          // would it be better to send an event?
          this.fire('paper-stepper-forward');
          return true;
        }
        return false;
      },

      _computeSelectable: function(disabled) {
        // TODO: factorize the expression
        return !disabled;
      }

    });

  </script>
</dom-module>
