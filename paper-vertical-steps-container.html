<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../polymer/polymer.html">

<dom-module id="paper-vertical-steps-container">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
      }
    </style>

    <slot id="slot"></slot>


        <!-- <template>
          <step-vertical-label
            id="verticalStepLabel"
            editable="[[editable]]"
            label="[[label]]"
            optional="[[optional]]"
            opened="[[opened]]"
            selectable="[[selectable]]"
            stepper-data="[[_stepperData]]"
            index="[[index]]"
            saved="[[saved]]">
          </step-vertical-label>
        </template>

        <iron-collapse id="collapse" opened="[[opened]]">
        <div id="contentConnectorLine"></div>
        <div id="stepWrapper">
        <div id="paperStepWrapper">
      </div>
    </div>
  </iron-collapse>-->

  </template>
  <script>
    Polymer({
      is: 'paper-vertical-steps-container',

      attached: function() {
        this._observeItems(this);
      },

      // observe items change under the given node.
      _observeItems: function(node) {
        return Polymer.dom(node).observeNodes(function(mutation) {
          mutation.addedNodes.length &&
          this._processAddedSteps(this._filterSteps(mutation.addedNodes));

          mutation.removedNodes.length &&
          this._processRemovedSteps(this._filterSteps(mutation.removedNodes));
        });
      },

      _processAddedSteps: function(steps) {
        Array.prototype.forEach.call(steps, this._prepareStepInsertion.bind(this));
      },

      _processRemovedSteps: function(steps) {
        Array.prototype.forEach.call(steps, this._resetStepInsertion);
      },

      _filterSteps: function(nodes) {
        return Array.prototype.filter.call(nodes, this.isStep);
      },

      /**
       * Return true if the node is a step.
       * @param  {HTMLElement} node The node to test.
       * @return {Boolean}          True if the ode is a step.
       */
      isStep: function(node) {
        return node.localName === 'paper-step';
      },

      _resetStepInsertion: function(step) {
        step.removeAttribute('slot');
      },

      _prepareStepInsertion: function(step) {
        var i = step.index;
        this.ensureVerticalStepSlot(i);
        step.setAttribute('slot', 'vertical-step-' + i);
        step.style.order = i*2;
      },

      ensureVerticalStepSlot(index) {
        if (!this._getVerticalStepSlot(index)) {
          this._addVerticalStepSlot(index);
        }
      },

      _getVerticalStepSlot: function(index) {
        return this.$$( Polymer.Element ?
          'slot[name=\'vertical-step-' + index + '\']' :
          'content[select="[slot=\'vertical-step-' + index + '\']"]'
        );
      },

      _addVerticalStepSlot: function(index) {
        Polymer.dom(this.root).insertBefore(this.createSlot('vertical-step-' + index), this.$.slot);
      },

      createSlot: function(name) {
        var slot;
        if (Polymer.Element) {
          slot = document.createElement('slot');
          if (name) slot.setAttribute('name', name);
        } else {
          slot = document.createElement('content');
          if (name) slot.setAttribute('select', "[slot='" + name + "']");
        }
        return slot;
      },

    });
  </script>
</dom-module>
